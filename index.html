<!DOCTYPE html>
<meta charset="utf-8">
<style>
  .canton-boundary {
    fill: none;
    stroke: #fff;
    stroke-linejoin: round;
  }

  .canton {
    opacity: 1;
     transform: translate(0, 0);
  }

  .canton:hover {
    opacity: .7;
  }

  .tooltip {
      position: absolute;
      width: 60px;
      padding: 2px;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      border-radius: 3px;
      pointer-events: none;
  }


</style>
<body>
  <nav>
    <select id="data-selection">
      <option value="einheitskrankenkasse">Einheitskrankenkasse</option>
      <option value="mehrwertsteuer">Mehrwertsteuer</option>
    </select>
  </nav>
<main>

</main>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="cantons.js"></script>
<script src="einheitskrankenkasse.js"></script>
<script src="mehrwertsteuer.js"></script>
<script>

  var selectedData = einheitskrankenkasse;

  document.getElementById('data-selection').addEventListener('change', function(event) {
    selectedData = eval(event.currentTarget.value);
    fillCantons();
  });

  var width = 960,
      height = 600;

  var projection = d3.geo.albers()
      .rotate([0, 0])
      .center([8.3, 46.8])
      .scale(16000)
      .translate([width / 2, height / 2])
      .precision(.1);

  var path = d3.geo.path()
      .projection(projection);

  // insert svg element
  var svg = d3.select("main").append("svg")
      .attr("width", width)
      .attr("height", height);

  // draw switzerland
  svg.append("path")
      .datum(cantons)
      .attr("class", "switzerland")
      .attr("d", path);

  // draw boundaryies
  svg.append("path")
      .datum(topojson.mesh(swiss, swiss.objects.cantons, function(a, b) { return a !== b; }))
      .attr("class", "canton-boundary")
      .attr("d", path);

  // fill the cantons
  var cantons = topojson.feature(swiss, swiss.objects.cantons).features;

  fillCantons();

  var div = d3.select("body").append("div")
          .attr("class", "tooltip")
          .style("opacity", 0);

  // fills the cantons with red or green, depending on the results.
  function fillCantons() {
     svg.selectAll(".canton").remove();
     svg.selectAll(".canton")
      .data(cantons)
      .enter().insert("path", ".canton-boundary")
      .attr("class", "canton")
      .attr("d", path)
      .style("fill", function(d, i) {
        var data = getData(d.id);
        return data.yes > data.no ? "#10A123" : "#BF0202";
      })
      .on("mouseover", function(d, i) {
         div.transition()
                 .duration(200)
                 .style("opacity", .9);

        var data = getData(d.id);
        div .html("Yes: " + data.yes + "<br/>No: " + data.no )
           .style("left", (d3.event.pageX) + "px")
           .style("top", (d3.event.pageY - 28) + "px");
        });
  }

  // gets the data for a specific canton.
  function getData(canton) {
    var data = selectedData.results.filter(function(element){
      if(element.canton == canton) {
        return element;
      }
    });

    return data[0];
  }


</script>
</body>
